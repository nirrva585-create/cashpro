<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safe Meme Coin Tool - DexScreener Solana Focus</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0a0a0a; color: #ddd; margin: 20px; }
    h1 { text-align: center; color: #00ff00; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #333; padding: 10px; text-align: center; }
    th { background: #222; }
    .entry { background: #004400; }
    .alert { background: #440000; }
    .link, button { color: #0ff; background: none; border: 1px solid #0ff; padding: 5px 10px; cursor: pointer; text-decoration: none; }
    button:hover { background: #0ff; color: #000; }
    #controls { text-align: center; margin: 20px; }
    #wallet-info { text-align: center; font-weight: bold; }
    #last-update, #error { text-align: center; font-style: italic; }
    #error { color: #f00; }
  </style>
</head>
<body>
  <h1>Safe Solana Meme Dashboard (DexScreener Only – Pump.fun Migrated Proxy)</h1>
  <p style="text-align:center;">Shows recent/hot Solana Raydium pairs (many from Pump.fun migrations). Safety: Liq ≥ $5k. Alerts on entry/exit/rug risk. Pump.fun direct links added (view bonding curve if pre-migration).<br>
  No broken APIs. Refresh often. DYOR – high risk!</p>

  <div id="controls">
    <button onclick="loadData()">Refresh Now</button>
    <button id="connect-btn" onclick="connectWallet()">Connect Phantom</button>
    <div id="wallet-info">Wallet: Not connected</div>
  </div>

  <div id="last-update">Loading...</div>
  <div id="error"></div>

  <table id="table">
    <thead>
      <tr>
        <th>Token</th>
        <th>Price USD</th>
        <th>FDV</th>
        <th>Liquidity USD</th>
        <th>m5 Buys/Sells</th>
        <th>m5 Volume USD</th>
        <th>m5 % Change</th>
        <th>Pair Age (min)</th>
        <th>Alerts</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    const DEX_SEARCH_URL = 'https://api.dexscreener.com/latest/dex/search?q=solana raydium meme';
    const SOL_MINT = 'So11111111111111111111111111111111111111112';
    let walletAddress = null;

    const TABLE = document.getElementById('tbody');
    const UPDATE_EL = document.getElementById('last-update');
    const ERROR_EL = document.getElementById('error');
    const WALLET_EL = document.getElementById('wallet-info');

    async function fetchJson(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status} - ${res.statusText}`);
      return res.json();
    }

    async function connectWallet() {
      if (window.solana && window.solana.isPhantom) {
        try {
          const resp = await window.solana.connect();
          walletAddress = resp.publicKey.toString();
          WALLET_EL.textContent = `Wallet: ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}`;
        } catch (err) {
          alert('Connection failed: ' + err.message);
        }
      } else {
        alert('Install Phantom wallet!');
      }
    }

    function playAlertSound() {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = audioCtx.createOscillator();
      osc.type = 'sine';
      osc.frequency.value = 800;
      osc.connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.3);
    }

    async function loadData() {
      try {
        ERROR_EL.textContent = '';
        const searchRes = await fetchJson(DEX_SEARCH_URL);
        const pairs = searchRes.pairs || [];

        const results = pairs
          .filter(p => p.chainId === 'solana' && p.liquidity?.usd >= 5000) // Safety filter
          .map(p => {
            const ageMin = p.pairCreatedAt ? Math.round((Date.now() - p.pairCreatedAt) / 60000) : 'N/A';
            const m5 = p.txns?.m5 || {};
            const buys = m5.buys || 0;
            const sells = m5.sells || 0;
            const vol = p.volume?.m5 || 0;
            const change = p.priceChange?.m5 || 0;
            const liq = p.liquidity?.usd || 0;
            const fdv = p.fdv || 0;

            let alert = '';
            if (sells > buys * 2 || change < -25 || liq / fdv < 0.05) alert = 'RUG RISK! High sells / drop / low liq ratio.';
            else if (buys > 15 && buys > sells && vol > 8000 && change > 8) alert = 'Potential SAFE ENTRY – buy volume surge.';
            else if (sells > buys && change < -8) alert = 'EXIT ALERT – sell pressure.';

            const mint = p.baseToken.address;
            const pumpLink = `https://pump.fun/${mint}`;
            const jupLink = `https://jup.ag/swap/${SOL_MINT}-${mint}`;

            return {
              symbol: p.baseToken.symbol,
              price: p.priceUsd ? Number(p.priceUsd).toFixed(6) : 'N/A',
              fdv: fdv.toLocaleString(),
              liq: liq.toLocaleString(),
              m5BuysSells: `${buys}/${sells}`,
              m5Vol: vol.toLocaleString(),
              m5Change: change.toFixed(2) + '%',
              age: ageMin,
              alert,
              dsUrl: p.url,
              pumpLink,
              jupLink
            };
          })
          .sort((a, b) => {
            const aScore = a.alert.includes('ENTRY') ? 5 : a.alert.includes('RISK') ? -3 : 0;
            const bScore = b.alert.includes('ENTRY') ? 5 : b.alert.includes('RISK') ? -3 : 0;
            return bScore - aScore || parseFloat(b.m5Change) - parseFloat(a.m5Change) || b.m5Vol - a.m5Vol;
          })
          .slice(0, 15); // Limit to top 15 for performance

        TABLE.innerHTML = '';
        let hasAlert = false;
        results.forEach(r => {
          const row = document.createElement('tr');
          let cls = '';
          if (r.alert.includes('ENTRY')) { cls = 'entry'; hasAlert = true; }
          if (r.alert.includes('RISK') || r.alert.includes('EXIT')) { cls = 'alert'; hasAlert = true; }
          row.className = cls;

          row.innerHTML = `
            <td>${r.symbol}</td>
            <td>$${r.price}</td>
            <td>$${r.fdv}</td>
            <td>$${r.liq}</td>
            <td>${r.m5BuysSells}</td>
            <td>$${r.m5Vol}</td>
            <td>${r.m5Change}</td>
            <td>${r.age}</td>
            <td>${r.alert || '-'}</td>
            <td>
              <a href="${r.dsUrl}" target="_blank" class="link">DexScreener</a> |
              <a href="${r.pumpLink}" target="_blank" class="link">Pump.fun</a> |
              <a href="${r.jupLink}" target="_blank" class="link">Buy Jupiter</a>
            </td>
          `;
          TABLE.appendChild(row);
        });

        UPDATE_EL.textContent = `Last update: ${new Date().toLocaleTimeString()} – Showing top Solana Raydium pairs (many Pump.fun graduates)`;
        if (hasAlert) playAlertSound();
      } catch (err) {
        ERROR_EL.textContent = 'Error: ' + err.message + ' – API may be rate-limited or changed. Wait 1 min & retry.';
      }
    }

    loadData();
    setInterval(loadData, 30000);
  </script>
</body>
</html>
